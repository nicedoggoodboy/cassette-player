function onYTState(e) {
    // 曲終了時
    if (e.data === YT.PlayerState.ENDED) {
      if (playingAll) {
        let totalList = [...tracksA, ...tracksB];
        let idx = (currentSide === "B" ? currentIdx + tracksA.length : currentIdx);
        if (idx < totalList.length - 1) {
          // 次の曲へ
          idx++;
          if (idx < tracksA.length) {
            currentSide = "A";
            currentIdx = idx;
            tabA.classList.add("active"); tabB.classList.remove("active");
          } else {
            currentSide = "B";
            currentIdx = idx - tracksA.length;
            tabA.classList.remove("active"); tabB.classList.add("active");
          }
          playCurrent();
        } else if (isLoop) {
          // ★ここを修正★
          // 両面ループ時は最初に戻って再生！
          currentSide = "A";
          currentIdx = 0;
          tabA.classList.add("active"); tabB.classList.remove("active");
          playCurrent();
        }
      } else {
        const list = currentSide === "A" ? tracksA : tracksB;
        if (currentIdx < list.length - 1) {
          currentIdx++;
          playCurrent();
        } else if (isLoop) {
          currentIdx = 0;
          playCurrent();
        }
      }
    }
  }
  